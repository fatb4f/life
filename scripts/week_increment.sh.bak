#!/usr/bin/env bash
set -euo pipefail
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
ROOT_DIR="$(cd "$SCRIPT_DIR/.." && pwd)"
source "$SCRIPT_DIR/common.sh"

WEEK_TEMPLATE="$ROOT_DIR/seeds/weeks/week-template.md"
WEEK_DIR="$ROOT_DIR/seeds/weeks"
mkdir -p "$WEEK_DIR"

# Find next week number
n=$(ls "$WEEK_DIR" 2>/dev/null | grep -E '^week-[0-9]+.md$' | sed -E 's/[^0-9]//g' | sort -n | tail -n1)
next=$(( ${n:-0} + 1 ))
out="$WEEK_DIR/week-$next.md"

if [[ -f "$out" ]]; then
  echo "Week file already exists: $out"
else
  if [[ -f "$WEEK_TEMPLATE" ]]; then
    cp "$WEEK_TEMPLATE" "$out"
  else
    cat > "$out" <<'EOF'
# Week N Sprint
- Goals:
- Must-do:
- Nice-to-have:

## Tasks
- [ ] Example task

## Notes
- ...
EOF
  fi
  echo "Created $out"
fi
